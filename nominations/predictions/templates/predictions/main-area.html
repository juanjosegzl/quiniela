{% extends "predictions/base.html" %}

{% block main-area %}
<form id="predictions-form" action="{% url "index" %}" method="POST">
  {% csrf_token %}
  {% for category_id, category in categories.items %}
  <section>
      <h2 id="section-{{ category_id }}">{{ category.name }}</h2>
      <div
        id="carousel-category-{{ category_id }}"
        class="carousel slide"
        data-bs-ride="carousel"
        data-bs-interval="false"
        >
        <div class="carousel-indicators">
          {% for entity in category.entities %}
            <button
              type="button"
              data-bs-target="#carousel-category-{{ category_id }}"
              data-bs-slide-to="{{ forloop.counter0 }}"
              class="{% if forloop.first %}active{% endif %}"
              >
            </button>
          {% endfor %}
        </div>
        <div class="carousel-inner">
          {% for entity in category.entities %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <h3>{{ entity.name }}</h3>
              <div
                id="{{category_id}}-{{ entity.id}}{{ entity.youtube_video_id }}"
                class="yt-player"
                data-video-id="{{ entity.youtube_video_id }}"
                >
              </div>
            </div>
          {% endfor %}
        </div>
        <button
          class="carousel-control-prev"
          type="button"
          data-bs-target="#carousel-category-{{ category_id }}"
          data-bs-slide="prev"
          >
          <span class="carousel-control-prev-icon"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button
          class="carousel-control-next"
          type="button"
          data-bs-target="#carousel-category-{{ category_id }}"
          data-bs-slide="next"
          >
          <span class="carousel-control-next-icon"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>

      <div class="row">
        {% if request.user.is_authenticated %}
          {% autoescape off %}
            {{ form | get_item:category_id }}
          {% endautoescape %}
        {% else %}
          <div class="col">
            <a
              href="{% url "login" %}"
              type="button" class="btn btn-primary"
              >Sign up to vote
            </a>
          </div>
          {% endif %}
      </div>
    </section>
  {% endfor %}
</form>
{% endblock %}


{% block sidebar %}
  <div class="sticky-top">
    <nav id="navbar" class="navbar">
      <nav class="nav nav-pills flex-column">
        {% for category_id, category in categories.items %}
          <a class="nav-link {% if forloop.first %}active{% endif %}" href="#carousel-category-{{ category_id }}">{{ category.name }}</a>
        {% endfor %}
      </nav>
    </nav>

    <nav class="navbar">
      <nav class="nav nav-pills flex-column">
        {% if request.user.is_authenticated %}
          <a class="nav-link" href="{% url "predictions" %}">My Predictions</a>
          <a class="nav-link" href="{% url "logout" %}">Logout</a>
          <button form="predictions-form" type="submit" class="btn btn-primary">Submit</button>
        {% else %}
          <a class="nav-link" href="{% url "login" %}">Login</a>
        {% endif %}
      </nav>
    </nav>
  </div>
{% endblock %}
